#include <Servo.h>
#include <SoftwareSerial.h>

const int fireSensorPin = 2; // AteÅŸ sensÃ¶rÃ¼nÃ¼n baÄŸlÄ± olduÄŸu dijital pin
const int servoPin = 7;      // Servo motorunun baÄŸlÄ± olduÄŸu dijital pin
Servo myServo;               // Servo motor nesnesi

bool fireDetected = false;   // AteÅŸ algÄ±landÄ± mÄ± kontrolÃ¼ iÃ§in deÄŸiÅŸken

// Bluetooth modÃ¼lÃ¼ iÃ§in SoftwareSerial pinleri
// Arduino RX pini <---> Bluetooth TX pini
// Arduino TX pini <---> Bluetooth RX pini
// Burada Arduino'da 10 pinini RX, 11 pinini TX olarak seÃ§iyoruz
SoftwareSerial SoftwareSerialTX(1,0); // RX, TX

void setup() {
  pinMode(fireSensorPin, INPUT); // AteÅŸ sensÃ¶rÃ¼nÃ¼ dijital giriÅŸ olarak ayarlÄ±yoruz
  myServo.attach(servoPin);      // Servo motoru baÄŸlÄ±yoruz
  myServo.write(170);             // Servo motorunu 170 dereceye (kapalÄ± pozisyon) ayarlÄ±yoruz
  Serial.begin(9600);            // Seri haberleÅŸmeyi baÅŸlatÄ±yoruz
  SoftwareSerialTX.begin(9600);  // Bluetooth seri haberleÅŸmesini baÅŸlatÄ±yoruz
  Serial.println("Sistem baÅŸlatÄ±ldÄ±. AteÅŸ algÄ±lamayÄ± bekliyor...");
}

void loop() {
  int sensorValue = digitalRead(fireSensorPin); // AteÅŸ sensÃ¶rÃ¼nden dijital deÄŸer okuyoruz

  if (sensorValue == LOW && !fireDetected) { // EÄŸer ateÅŸ algÄ±landÄ±ysa (LOW durumu)
    fireDetected = true;
    myServo.write(180);  // Servo motorunu 180 dereceye (Ã¶rneÄŸin, sÃ¶ndÃ¼rÃ¼cÃ¼ aÃ§ma) dÃ¶ndÃ¼rÃ¼yoruz
    Serial.println("AteÅŸ tespit edildi, sÃ¶ndÃ¼rme Ã§abasÄ± baÅŸladÄ± ğŸ”¥ğŸ”¥");
    SoftwareSerialTX.println("AteÅŸ tespit edildi");  // Bluetooth Ã¼zerinden mesaj gÃ¶nder
  }
  else if (sensorValue == HIGH && fireDetected) { // EÄŸer ateÅŸ tespit edilmedi
    fireDetected = false;
    myServo.write(90); // Servo motorunu 90 dereceye (dinlenme pozisyonu) dÃ¶ndÃ¼rÃ¼yoruz
    Serial.println("AteÅŸ yok, sÃ¶ndÃ¼rme Ã§abasÄ± sonlandÄ±.");
    SoftwareSerialTX.println("AteÅŸ yok");  // Bluetooth Ã¼zerinden mesaj gÃ¶nder
  }

  // Bluetooth Ã¼zerinden gelen veriyi kontrol et
  if (SoftwareSerialTX.available()) {
    String command = SoftwareSerialTX.readStringUntil('\n'); // Gelen komutu oku
    command.trim(); // Sonundaki boÅŸluklarÄ± temizle

    if (command.equalsIgnoreCase("status")) {
      // Mevcut ateÅŸ durumunu yanÄ±tla
      if (fireDetected) {
        SoftwareSerialTX.println("AteÅŸ tespit edildi");
      } else {
        SoftwareSerialTX.println("AteÅŸ yok");
      }
    }
  }

  delay(500); // Bir yarÄ±m saniye bekliyoruz
}

/*
BaÄŸlantÄ± notlarÄ±:
- AteÅŸ sensÃ¶rÃ¼nÃ¼n Ã§Ä±kÄ±ÅŸÄ±nÄ± Arduino dijital pin 2'ye baÄŸlayÄ±n
- Servo motorun sinyal kablosunu Arduino pin 7'ye baÄŸlayÄ±n
- Bluetooth modÃ¼lÃ¼nÃ¼n pinlerini ÅŸu ÅŸekilde baÄŸlayÄ±n:
   Bluetooth TX -> Arduino pin 10 (Arduino RX)
   Bluetooth RX -> Arduino pin 11 (Arduino TX)
   Bluetooth VCC -> 5V (veya 3.3V, modÃ¼le baÄŸlÄ± olarak)
   Bluetooth GND -> GND

Ã–nemli:
RX ve TX pinleri Bluetooth ile Arduino arasÄ±nda Ã§apraz baÄŸlanmalÄ±dÄ±r.
0 ve 1 pinleri, Arduino'nun USB Ã¼zerinden Seri monitÃ¶r iÃ§in kullanÄ±lÄ±r ve serbest bÄ±rakÄ±lmalÄ±dÄ±r.
